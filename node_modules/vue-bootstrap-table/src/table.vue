<script>
    /**
     * Bootstrap style table component for Vue
     */
    
    export default {
        props: {
            // 排序列
            sortColumn: String,
            // 排序类型
            sortType: String,

            // 「每页显示」默认选项
            sizeList: {
                type: Array,
                default: () => [10, 25, 50, 'All']
            },
            // 显示的文字
            sizeText: {
                type: String,
                default: '每页显示：'
            },
            // 选中的size，此选项不为空才会显示「每页显示」
            size: null
            
            /*// 是否显示边框
            border: {
                type: Boolean,
                default: true
            },
            // 是否显示条纹
            stripe: {
                type: Boolean,
                default: true
            }*/
        },
        ready () {
            this.buildSort();
            //this.buildTableClass();
        },
        methods: {
            /**
             * 修改<th>标签，加上排序相关的指令
             */
            buildSort () {
                let $thead = $('thead', this.$el);

                // 给需要排序的th加上 :class="getSortClass(column)" @click="sort(column)"
                $thead.find('th[sort]').each(function() {
                    let $this = $(this),
                        column = $this.attr('sort');

                    $this.attr(':class', `getSortClass('${column}')`);
                    $this.attr('v-on:click', `sort('${column}')`);
                });

                // 编译
                this.$compile($thead[0]);
            },
            
            /*buildTableClass () {
                let className = ['table'];

                if (this.border) {
                    className.push('table-bordered');
                }

                if (this.stripe) {
                    className.push('table-striped');
                }

                $('table', this.$el).addClass(className.join(' '));
            },*/

            /**
             * 获取排序class
             * @param  {[type]} column [description]
             * @return {[type]}        [description]
             */
            getSortClass (column) {
                let isCurrentColumn = this.sortColumn === column;

                return {
                    "sorting": !isCurrentColumn || !this.sortType, 
                    "sorting-desc": isCurrentColumn && this.sortType === 'desc',
                    "sorting-asc": isCurrentColumn && this.sortType === 'asc'
                };
            },
            /**
             * 排序
             * 每次点击按照： 倒序--正序--取消
             * @param  {[type]} column [description]
             */
            sort (column) {
                let type = null;

                // 在未排序过的列上，第一次点击按倒序
                if (this.sortColumn !== column || !this.sortType) {
                    type = 'desc';
                }
                // 在排过序的列上，如果是倒序则更改为正序，如果是正序则取消排序
                else if (this.sortType === 'desc') {
                    type = 'asc';
                }

                this.$emit('sort', column, type);
            },
            changeSize (e) {
                //this.pageSize = e.target.value;
                this.$emit('change-size', e.target.value);
            }
        }
    };

</script>

<template>
    <div class="vue-table">
        <!--每页显示-->
        <div class="page-size row" v-if="!!size">
            <div class="col-md-6 col-sm-6">
                <label>{{sizeText}}</label>
                <select class="form-control input-sm input-xsmall input-inline" :value="size" @change="changeSize">
                    <option v-for="item in sizeList" :value="item">{{item}}</option>
                </select>
            </div>
        </div>
        <!--表格-->
        <div class="table-responsive">
            <slot></slot>
        </div>
    </div>
</template>

<style lang="less">

    .vue-table {
        table {
            tbody, thead, tfoot {
                tr {
                    td, th {
                        word-break: break-all;
                        white-space: inherit;
                        vertical-align: middle;
                    }
                }
            }
            thead {
                tr {
                    th {
                        white-space: nowrap;
                    }
                }
            }
        }

        .sorting {
            cursor: pointer;
            background: url(../assets/sort_both.png) center right no-repeat;
        }
        .sorting-asc {
            cursor: pointer;
            background: url(../assets/sort_asc.png) center right no-repeat;
        }
        .sorting-desc {
            cursor: pointer;
            background: url(../assets/sort_desc.png) center right no-repeat;
        }

        .nowrap {
            white-space: nowrap; 
        }

        .page-size {
            margin-bottom: 15px;
        }
    }
</style>